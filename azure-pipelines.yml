jobs:
# - job: windows
#   pool:
#     vmImage: vs2017-win2016
#   steps:
#     - template: azure-pipelines-steps.yml

# - job: linux
#   pool:
#     vmImage: ubuntu-16.04
#   steps:
#     - template: azure-pipelines-steps.yml

- job: macOS
  pool:
    vmImage: macos-10.14
  steps:
  - bash: echo "$(ruby --version)"

  - script: |
      echo "127.0.0.1 $(sudo scutil --get LocalHostName).local" | sudo tee -a /etc/hosts
    displayName: Fix hostname

  - script: printenv
    displayName: Dump environment variables

  # - task: UseRubyVersion@0
  #   inputs:
  #     versionSpec: 2.3.x

  - bash: echo "$(ruby --version)"

  # - bash: |
  #     brew config    
  #     brew services list
  #     brew cleanup --debug --verbose    
  #     brew doctor
  #   displayName: More debug
  #   env:
  #     HOMEBREW_DEVELOPER: 1

  - bash: (nohup brew update --debug > brew.out 2> brew.err &)
    continueOnError: true

  - bash: |
      sleep 120
      echo "$(cat brew.out)"
      echo "$(cat brew.err)"
    displayName: 'Show brew output'
    condition: always()

  - script: script/setup-dependencies.sh
    displayName: Setup dependencies
